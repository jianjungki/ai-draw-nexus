import{_ as l,l as m,d as k}from"./index-BsZN8iTB.js";import{c as P}from"./cytoscape.esm-5J0xJHOV.js";import{c as q}from"./cytoscape-cose-bilkent-BvVvwdEz.js";P.use(q);function D(t,o){t.forEach(e=>{const n={id:e.id,labelText:e.label,height:e.height,width:e.width,padding:e.padding??0};Object.keys(e).forEach(i=>{["id","label","height","width","padding","x","y"].includes(i)||(n[i]=e[i])}),o.add({group:"nodes",data:n,position:{x:e.x??0,y:e.y??0}})})}l(D,"addNodes");function I(t,o){t.forEach(e=>{const n={id:e.id,source:e.start,target:e.end};Object.keys(e).forEach(i=>{["id","start","end"].includes(i)||(n[i]=e[i])}),o.add({group:"edges",data:n})})}l(I,"addEdges");function $(t){return new Promise(o=>{const e=k("body").append("div").attr("id","cy").attr("style","display:none"),n=P({container:document.getElementById("cy"),style:[{selector:"edge",style:{"curve-style":"bezier"}}]});e.remove(),D(t.nodes,n),I(t.edges,n),n.nodes().forEach(function(a){a.layoutDimensions=()=>{const y=a.data();return{w:y.width,h:y.height}}});const i={name:"cose-bilkent",quality:"proof",styleEnabled:!1,animate:!1};n.layout(i).run(),n.ready(a=>{m.info("Cytoscape ready",a),o(n)})})}l($,"createCytoscapeInstance");function X(t){return t.nodes().map(o=>{const e=o.data(),n=o.position(),i={id:e.id,x:n.x,y:n.y};return Object.keys(e).forEach(a=>{a!=="id"&&(i[a]=e[a])}),i})}l(X,"extractPositionedNodes");function Y(t){return t.edges().map(o=>{const e=o.data(),n=o._private.rscratch,i={id:e.id,source:e.source,target:e.target,startX:n.startX,startY:n.startY,midX:n.midX,midY:n.midY,endX:n.endX,endY:n.endY};return Object.keys(e).forEach(a=>{["id","source","target"].includes(a)||(i[a]=e[a])}),i})}l(Y,"extractPositionedEdges");async function v(t,o){m.debug("Starting cose-bilkent layout algorithm");try{B(t);const e=await $(t),n=X(e),i=Y(e);return m.debug(`Layout completed: ${n.length} nodes, ${i.length} edges`),{nodes:n,edges:i}}catch(e){throw m.error("Error in cose-bilkent layout algorithm:",e),e}}l(v,"executeCoseBilkentLayout");function B(t){if(!t)throw new Error("Layout data is required");if(!t.config)throw new Error("Configuration is required in layout data");if(!t.rootNode)throw new Error("Root node is required");if(!t.nodes||!Array.isArray(t.nodes))throw new Error("No nodes found in layout data");if(!Array.isArray(t.edges))throw new Error("Edges array is required in layout data");return!0}l(B,"validateLayoutData");var O=l(async(t,o,{insertCluster:e,insertEdge:n,insertEdgeLabel:i,insertMarkers:a,insertNode:y,log:c,positionEdgeLabel:x},{algorithm:j})=>{const u={},p={},f=o.select("g");a(f,t.markers,t.type,t.diagramId);const C=f.insert("g").attr("class","subgraphs"),E=f.insert("g").attr("class","edgePaths"),A=f.insert("g").attr("class","edgeLabels"),N=f.insert("g").attr("class","nodes");c.debug("Inserting nodes into DOM for dimension calculation"),await Promise.all(t.nodes.map(async s=>{if(s.isGroup){const r={...s};p[s.id]=r,u[s.id]=r,await e(C,s)}else{const r={...s};u[s.id]=r;const d=await y(N,s,{config:t.config,dir:t.direction||"TB"}),g=d.node().getBBox();r.width=g.width,r.height=g.height,r.domId=d,c.debug(`Node ${s.id} dimensions: ${g.width}x${g.height}`)}})),c.debug("Running cose-bilkent layout algorithm");const _={...t,nodes:t.nodes.map(s=>{const r=u[s.id];return{...s,width:r.width,height:r.height}})},b=await v(_,t.config);c.debug("Positioning nodes based on layout results"),b.nodes.forEach(s=>{const r=u[s.id];r?.domId&&(r.domId.attr("transform",`translate(${s.x}, ${s.y})`),r.x=s.x,r.y=s.y,c.debug(`Positioned node ${r.id} at center (${s.x}, ${s.y})`))}),b.edges.forEach(s=>{const r=t.edges.find(d=>d.id===s.id);r&&(r.points=[{x:s.startX,y:s.startY},{x:s.midX,y:s.midY},{x:s.endX,y:s.endY}])}),c.debug("Inserting and positioning edges"),await Promise.all(t.edges.map(async s=>{await i(A,s);const r=u[s.start??""],d=u[s.end??""];if(r&&d){const g=b.edges.find(h=>h.id===s.id);if(g){c.debug("APA01 positionedEdge",g);const h={...s},w=n(E,h,p,t.type,r,d,t.diagramId);x(h,w)}else{const h={...s,points:[{x:r.x||0,y:r.y||0},{x:d.x||0,y:d.y||0}]},w=n(E,h,p,t.type,r,d,t.diagramId);x(h,w)}}})),c.debug("Cose-bilkent rendering completed")},"render"),T=O;export{T as render};
